<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>Keluarga MORHA</title>

    <!-- Bootstrap core CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="./css/custom.css" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    
  </head>
  <body>

      <header>
          <div class="collapse bg-dark" id="navbarHeader">
            <div class="container">
              <div class="row">
                <div class="col-sm-8 col-md-7 py-4">
                  <h4 class="text-white">i.M.Here</h4>
                  <p class="text-secondary">Welcome <holder id="txt-name-top"></holder>! This is you Dashboard, for viewing your sessions, and your past attendance. In order to utilize i.M.Here, you would need to download the i.M.Here mobile app via Google Playstore or Apple Appstore. Also, ensure that your organization regisytrar has enrolled you in!</p>
                </div>
                <div class="col-sm-4 offset-md-1 py-4">
                  <h4 class="text-white">Navigational</h4>
                    <ul class="list-unstyled">
                      <li><a href="main.html?v=manageUser" class="text-white">Manage Users</a></li>
                      <li><a href="main.html?v=manageSession" class="text-white">Manage Sessions</a></li>
                      <li><a href="main.html?v=reportStatistic" class="text-white">Reports & Statistics</a></li>
                    </ul>
                  <h4 class="text-white">Support + Contact</h4>
                  <ul class="list-unstyled">
                    <li><a href="#" class="text-white">Twitter Help @imhere_support</a></li>
                    <li><a href="#" class="text-white">Email Support</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
          <div class="navbar navbar-dark bg-dark box-shadow">
            <div class="container d-flex justify-content-between">
              <a href="main.html" class="navbar-brand d-flex align-items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>
                <strong>i.<text class="text-danger">M</text>.Here</strong>
              </a>
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarHeader" aria-controls="navbarHeader" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
            </div>
          </div>
        </header>

    <main role="main">
      
      <br />
      <div class="container">
        <holder id="page-content"></holder>
      </div>

      <!-- FOOTER -->
      <footer class="container">
        <hr class="mb-12" >
        <p class="float-right"><a href="#" class="text-muted" id="btn-logout">Logout</a></p>
        <p>&copy; 2017-2019 WTW Fintech Sdn Bhd &middot; <a href="privacy.html">Data Privacy Policy</a> &middot; <a href="#">Terms of Use</a></p>
      </footer>
      
    </main>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.bundle.min.js" integrity="sha384-xrRywqdh3PHs8keKZN+8zzc5TX0GRTLCcmivcbNJWm2rs5C8PRhcEn3czEjhAO9o" crossorigin="anonymous"></script>
    <!-- Firebase Initi
    ================================================== -->
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.9.0/firebase-auth.js"></script>
    <script src="./js/init-firebase.js"></script>
    <!-- Main Scirptiing
    ================================================= -->
    <script>
      
      const monthNames = ["January", "February", "March", "April", "May", "June","July", "August", "September", "October", "November", "December"];
      var today = new Date();
      var date = today.getDate()+'-'+(today.getMonth()+1)+'-'+today.getFullYear();
      console.log("date is: "+date);
      var time = today.getHours() + ":" + today.getMinutes() + ":" + today.getSeconds();
      var dateTime = date+' '+time;
      
      function timeConverter(UNIX_timestamp){
        var a = new Date(UNIX_timestamp * 1000);
        var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        var year = a.getFullYear();
        var month = months[a.getMonth()];
        var date = a.getDate();
        var hour = '0'+a.getHours();
        var min = '0'+a.getMinutes();
        var sec = '0'+a.getSeconds();
        var time = month+' '+date+' / '+hour.slice(-2)+':'+min.slice(-2);
        return time;
      }
      //console.log('Time converted: '+timeConverter(1553385600));

      function upFirst(string) {
            return string.charAt(0).toUpperCase() + string.slice(1);
      }

      function getParameterByName(name) {
          if (name !== "" && name !== null && name != undefined) {
              name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
              var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                  results = regex.exec(location.search);
              return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
          } else {
              var arr = location.href.split("/");
              return arr[arr.length - 1];
          }
      }
      
      $(function() {
        var pagetoLoad;
        if (getParameterByName('v')) {
          pageToLoad = 'inc_'+getParameterByName('v')+'.html';
          console.log('Loading '+getParameterByName('v')+'..');
        } else {
          console.log('Defaulting to Dashboard..');
          pageToLoad = 'inc_dashboard.html';
        }
        // Load the actual content page
        $('#page-content').load(pageToLoad);
      })
      
      $("#btn-logout").on('click', function() {
        firebase.auth().signOut().then(function() {
          window.location.replace(pageURL);
        }).catch(function(error) {
          console.log("Error signing out.");
        });
      })
      
      firebase.auth().onAuthStateChanged(function(user) {
        if (user) {
          console.log(JSON.stringify(user));
          console.log("User uid: "+user.uid);
          console.log("User phone number: "+user.phoneNumber);
          console.log("User provider: "+user.providerData[0].providerId);
          //window.location.replace(pageURL+pageMain);

          db.collection("users").where("phone","==",String(user.phoneNumber.substring(1)))
          .get().then(function(thisUser) {
            thisUser.forEach(function(userDoc) {
              console.log("User status is: "+userDoc.data().status);
              if (!userDoc.data().status) {
                window.location.replace(pageURL+"/activate.html");
              }
            });
          })
          .catch(function(e) {
            cobsole.log("Error: ",e);
          });

        } else {
          console.log("User NOT signed in!");
          window.location.replace(pageURL);
        }
      });

      // TYbale filter
      (function(document) {
        'use strict';

        var LightTableFilter = (function(Arr) {

          var _input;

          function _onInputEvent(e) {
            _input = e.target;
            var tables = document.getElementsByClassName(_input.getAttribute('data-table'));
            Arr.forEach.call(tables, function(table) {
              Arr.forEach.call(table.tBodies, function(tbody) {
                Arr.forEach.call(tbody.rows, _filter);
              });
            });
          }

          function _filter(row) {
            var text = row.textContent.toLowerCase(), val = _input.value.toLowerCase();
            row.style.display = text.indexOf(val) === -1 ? 'none' : 'table-row';
          }

          return {
            init: function() {
              var inputs = document.getElementsByClassName('light-table-filter');
              Arr.forEach.call(inputs, function(input) {
                input.oninput = _onInputEvent;
              });
            }
          };
        })(Array.prototype);

        document.addEventListener('readystatechange', function() {
          if (document.readyState === 'complete') {
            LightTableFilter.init();
          }
        });
    })(document);

    </script>
  </body>
